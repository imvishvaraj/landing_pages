{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/main.css' %}" >

    <style>
        {% block style %}
        {% endblock style %}
    </style>

    <title>Hello, world!</title>
  </head>
  <body>
    {% if messages %}
      <div class="alert alert-warning mb-0">
        <div class="container">
          {% for message in messages %}
            {{ message }} <br/>
          {% endfor %}
        </div>
      </div>      
    {% endif %}

    {% block content %}
    {% endblock %}

    <hr>
    
    <footer class="container">
    <p>&copy; Company 2017-2020</p>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

    <!-- adding custom jQuery script -->
  <script>
    $(document).ready(function() {
      var $marketingModal = $("#signUpModal");
      var didDismissModal = false;

      $("body").mouseleave(function() {
        if (!didDismissModal){
          $marketingModal.modal()
        }
      })

      $marketingModal.on("hidden.bs.modal", function(e){
        didDismissModal = true;
      })

      $(".join-form").submit(function(e) {
          e.preventDefault();
          var this_ = $(this);
          console.log($(this).serialize());
          var joinEmailAPIEndpoint = "{% url 'email-join' %}";
          $.ajax({
              method: "POST",
              data: $(this).serialize(),
              url: joinEmailAPIEndpoint,
              success: function(data) {
                  didDismissModal = true;
                  $marketingModal.modal('hide');
                  this_.find(".join-form").parent().html("<p class='lead'>Success! Thanks for joining us!</p>");
              },
              error: function(data){
                  this_.find(".join-form-alert").fadeIn();
                  this_.find(".join-form-error").text(data.responseJSON.email[0])
              }
          })
      })
    })

    
  </script>

    <script>
      $(document).ready(function() {
        {% block jquery %}{% endblock %}
      })
    </script>

    {% include 'newsletter/modal.html' %}
  </body>
</html>